<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Alpha diversity and geographic range size of Carboniferous and Permian tetrapods • palaeoverse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Alpha diversity and geographic range size of Carboniferous and Permian tetrapods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">palaeoverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/phanerozoic-reefs.html">Latitudinal trends in Phanerozoic reefs</a></li>
    <li><a class="dropdown-item" href="../articles/tetrapod-biodiversity.html">Alpha diversity and geographic range size of Carboniferous and Permian tetrapods</a></li>
    <li><a class="dropdown-item" href="../articles/structure-and-standards.html">Contributing to palaeoverse: structure and standards</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/palaeoverse/palaeoverse/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Alpha diversity and geographic range size of Carboniferous and Permian tetrapods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/palaeoverse/palaeoverse/blob/main/vignettes/tetrapod-biodiversity.Rmd" class="external-link"><code>vignettes/tetrapod-biodiversity.Rmd</code></a></small>
      <div class="d-none name"><code>tetrapod-biodiversity.Rmd</code></div>
    </div>

    
    
<p><strong>Authors:</strong> <a href="https://palaeoverse.org/#about-us" class="external-link">The Palaeoverse Development
Team</a></p>
<p><strong>Last updated:</strong> 2024-10-14</p>
<div style="text-align: justify">
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>palaeoverse</code> is an R package developed by
palaeobiologists, for palaeobiologists. The aim of the package is to
generate a community-driven toolkit of generic functions for the
palaeobiological community. The package does not provide implementations
of statistical analyses, rather it provides auxiliary functions to help
streamline analyses and improve code readability and reproducibility.
This vignette (or tutorial if you prefer) is provided to guide you
through the installation process and some of the functionality available
within <code>palaeoverse</code>. To do so, we will focus on a usage
example looking at various trends in tetrapods across the
Carboniferous/Permian boundary.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>The <code>palaeoverse</code> package can be installed via CRAN or its
dedicated <a href="https://github.com/palaeoverse/palaeoverse" class="external-link">GitHub
repository</a> if the development version is preferred. To install via
the CRAN, simply use:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"palaeoverse"</span><span class="op">)</span></span></code></pre></div>
<p>To install the development version, first install the
<code>devtools</code> package, and then use <code>install_github</code>
to install <code>palaeoverse</code> directly from GitHub.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"palaeoverse/palaeoverse"</span><span class="op">)</span></span></code></pre></div>
<p>You can now load <code>palaeoverse</code> using the default
<code>library</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://palaeoverse.palaeoverse.org">palaeoverse</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Before we get onto the good stuff, the development team has a
small request</strong>. If you use <code>palaeoverse</code> in your
research, please cite the associated publication. This will help us to
continue our work in supporting you to do yours. You can access the
appropriate citation via:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"palaeoverse"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="now-that-thats-out-of-the-way-lets-begin">Now that that’s out of the way, let’s begin!<a class="anchor" aria-label="anchor" href="#now-that-thats-out-of-the-way-lets-begin"></a>
</h3>
<p>The Carboniferous and early Permian have been regarded as critical
intervals for early four-limbed vertebrates, in terms of both
diversification and biogeography. During this time several major groups
of tetrapods emerged (including crown amniotes), and the extensive
tropical rainforests of the Carboniferous gave way to dryland vegetation
during the Permian, in what’s known as the ‘Carboniferous Rainforest
Collapse’ (CRC) (for more information, see Dunne et al., 2018).</p>
<p>In this vignette we’ll use the <code>tetrapods</code> dataset to
demonstrate how to use <code>palaeoverse</code> functions to examine how
alpha diversity and range size vary across this interval.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-tetrapods-dataset">The Tetrapods Dataset<a class="anchor" aria-label="anchor" href="#the-tetrapods-dataset"></a>
</h2>
<p>Functions in <code>palaeoverse</code> are designed around the
assumption that most users’ data are stored in an occurrence
<code>data.frame</code>. As such, this is the expected input data format
for most functions. We provide two example occurrence datasets
(<code>tetrapods</code> and <code>reefs</code>) within the package from
different data sources. While these two datasets have similar
structures, the data (variables) available in each differ. The
<code>tetrapods</code> dataset is a compilation of Carboniferous–Early
Triassic tetrapod occurrences (<em>n</em> = 5,270) from the <a href="https://paleobiodb.org/#" class="external-link">Paleobiology Database</a>. We’ll be
using this dataset to demonstrate some of the available functionality in
<code>palaeoverse</code>.</p>
<p>Let’s get started by exploring the dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Call the dataset:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tetrapods</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the column names and the first five lines of the first three columns:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tetrapods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "occurrence_no"     "collection_no"     "identified_name"   "identified_rank"   "accepted_name"    </span></span>
<span><span class="co">##  [6] "accepted_rank"     "early_interval"    "late_interval"     "max_ma"            "min_ma"           </span></span>
<span><span class="co">## [11] "phylum"            "class"             "order"             "family"            "genus"            </span></span>
<span><span class="co">## [16] "abund_value"       "abund_unit"        "lng"               "lat"               "collection_name"  </span></span>
<span><span class="co">## [21] "cc"                "formation"         "stratgroup"        "member"            "zone"             </span></span>
<span><span class="co">## [26] "lithology1"        "environment"       "pres_mode"         "taxon_environment" "motility"         </span></span>
<span><span class="co">## [31] "life_habit"        "diet"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tetrapods</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   occurrence_no collection_no                        identified_name</span></span>
<span><span class="co">## 1        146665         12943     n. gen. Anconastes n. sp. vesperus</span></span>
<span><span class="co">## 2        147090         13004                     Gorgonopsia indet.</span></span>
<span><span class="co">## 3        147521         13043 n. gen. Procolophon n. sp. trigoniceps</span></span>
<span><span class="co">## 4        147523         13044       n. gen. Ophiodeirus n. sp. casei</span></span>
<span><span class="co">## 5        147563         13046         Broiliellus n. sp. arroyoensis</span></span></code></pre>
<p>As you can see, we have a variety of variables to play around with!
For this vignette we’ll mostly be focusing on some of the spatial
information, such as latitude and longitude. But first, we need to do
some data prep…</p>
</div>
<div class="section level2">
<h2 id="exploring-the-functions">Exploring the functions<a class="anchor" aria-label="anchor" href="#exploring-the-functions"></a>
</h2>
<p>If we’re looking at patterns of tetrapod diversity and distribution
over the Carboniferous and Permian, we’ll first have to bin our
occurrences by time and by space. We can do this easily with a few
functions in the <code>palaeoverse</code> package. Let’s first look at
binning by time.</p>
<p>There are two <code>palaeoverse</code> functions that help us to
assign occurrences to different intervals, or ‘bins’, of time. First,
we’ll use <code>time_bins</code> to make some suitable time bins for our
study. The function requires a maximum and a minimum time interval to
run. As we know we’re interested in looking at the Carboniferous and the
Permian, we can use these as our intervals to get the suitable
stage-level bins that we’re after:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate time bins</span></span>
<span><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/time_bins.html">time_bins</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Carboniferous"</span>, <span class="st">"Permian"</span><span class="op">)</span>,</span>
<span>                  rank <span class="op">=</span> <span class="st">"stage"</span>,</span>
<span>                  scale <span class="op">=</span> <span class="st">"GTS2012"</span>,</span>
<span>                  plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bins</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   bin interval_name  rank max_ma mid_ma min_ma duration_myr abbr  colour  font</span></span>
<span><span class="co">## 1   1   Tournaisian stage  358.9 352.80  346.7         12.2    T #8CB06C black</span></span>
<span><span class="co">## 2   2        Visean stage  346.7 338.80  330.9         15.8    V #A6B96C black</span></span>
<span><span class="co">## 3   3  Serpukhovian stage  330.9 327.05  323.2          7.7   Se #BFC26B black</span></span>
<span><span class="co">## 4   4    Bashkirian stage  323.2 319.20  315.2          8.0    B #99C2B5 black</span></span>
<span><span class="co">## 5   5     Moscovian stage  315.2 311.10  307.0          8.2    M #B3CBB9 black</span></span>
<span><span class="co">## 6   6    Kasimovian stage  307.0 305.35  303.7          3.3   Ka #BFD0C5 black</span></span></code></pre>
<p>Before we can bin our occurrences into these time bins, we will need
the ages of the occurrences in millions of years. Since the numeric ages
may have changed since we downloaded the data from the PBDB, we’ll use
<code>look_up</code> to get the numeric ages for the occurrences within
<code>tetrapods</code> dataset based on their assigned interval
names:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get new numeric ages for named intervals using the interval key that is supplied with Palaeoverse</span></span>
<span><span class="va">tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/look_up.html">look_up</a></span><span class="op">(</span><span class="va">tetrapods</span>, int_key <span class="op">=</span> <span class="va">interval_key</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make sure that any values which could not be matched contain their original values</span></span>
<span><span class="va">tetrapods</span><span class="op">$</span><span class="va">interval_max_ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">tetrapods</span><span class="op">$</span><span class="va">interval_max_ma</span><span class="op">)</span>,</span>
<span>                                    <span class="va">tetrapods</span><span class="op">$</span><span class="va">max_ma</span>,</span>
<span>                                    <span class="va">tetrapods</span><span class="op">$</span><span class="va">interval_max_ma</span><span class="op">)</span></span>
<span><span class="va">tetrapods</span><span class="op">$</span><span class="va">interval_min_ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">tetrapods</span><span class="op">$</span><span class="va">interval_min_ma</span><span class="op">)</span>,</span>
<span>                                    <span class="va">tetrapods</span><span class="op">$</span><span class="va">min_ma</span>,</span>
<span>                                    <span class="va">tetrapods</span><span class="op">$</span><span class="va">interval_min_ma</span><span class="op">)</span></span>
<span><span class="va">tetrapods</span><span class="op">$</span><span class="va">interval_mid_ma</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">tetrapods</span><span class="op">$</span><span class="va">min_ma</span> <span class="op">+</span> <span class="va">tetrapods</span><span class="op">$</span><span class="va">max_ma</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># Look at the updated dataset</span></span>
<span><span class="va">tetrapods</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">35</span><span class="op">:</span><span class="fl">37</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   interval_max_ma interval_mid_ma interval_min_ma</span></span>
<span><span class="co">## 1         307.000         302.400          298.90</span></span>
<span><span class="co">## 2         265.100         262.500          259.10</span></span>
<span><span class="co">## 3         251.902         249.685          247.20</span></span>
<span><span class="co">## 4         290.100         284.700          283.50</span></span>
<span><span class="co">## 5         283.500         275.800          272.95</span></span></code></pre>
<p>As you can see we’ve got some new columns with updated interval ages.
Handy!</p>
<p>Now we’re ready to bin the occurrences into these time bins using
<code>bin_time</code>. For now, we’ll go with the ‘mid’ method, but
we’ll talk about this more in a minute.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rename columns so that new intervals are used for binning</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tetrapods</span><span class="op">)</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"old_max_ma"</span>, <span class="st">"old_min_ma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tetrapods</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">37</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max_ma"</span>, <span class="st">"min_ma"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate time bins</span></span>
<span><span class="va">tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bin_time.html">bin_time</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">tetrapods</span>,</span>
<span>                      bins <span class="op">=</span> <span class="va">bins</span>,</span>
<span>                      method <span class="op">=</span> <span class="st">'mid'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in bin_time(occdf = tetrapods, bins = bins, method = "mid"): Minimum age of occurrence data is less than minimum age of bins.</span></span></code></pre>
<p>Oh no! We’ve hit an error. This is because there’s some occurrences
that sit outside of the time intervals we’re interested in.
<code>bin_time</code> can’t bin occurrences which sit outside of the
time intervals you’ve chosen, so for it to work, we’ll first have to
remove these occurrences.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove occurrences that are younger than the time intervals we're interested in</span></span>
<span><span class="va">cp_tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tetrapods</span>, <span class="va">min_ma</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">bins</span><span class="op">$</span><span class="va">min_ma</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bin occurrences into chosen time bins</span></span>
<span><span class="va">mid_tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bin_time.html">bin_time</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">cp_tetrapods</span>,</span>
<span>                          bins <span class="op">=</span> <span class="va">bins</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">'mid'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in bin_time(occdf = cp_tetrapods, bins = bins, method = "mid"): One or more occurrences have a midpoint age</span></span>
<span><span class="co">## equivalent to a bin boundary. Binning skipped for these occurrences. Hint: `which(is.na(occdf$bin_assignment))`.</span></span></code></pre>
<p>That’s better! Let’s see how our dataset has changed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Examine the dataset columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mid_tetrapods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "occurrence_no"     "collection_no"     "identified_name"   "identified_rank"   "accepted_name"    </span></span>
<span><span class="co">##  [6] "accepted_rank"     "early_interval"    "late_interval"     "old_max_ma"        "old_min_ma"       </span></span>
<span><span class="co">## [11] "phylum"            "class"             "order"             "family"            "genus"            </span></span>
<span><span class="co">## [16] "abund_value"       "abund_unit"        "lng"               "lat"               "collection_name"  </span></span>
<span><span class="co">## [21] "cc"                "formation"         "stratgroup"        "member"            "zone"             </span></span>
<span><span class="co">## [26] "lithology1"        "environment"       "pres_mode"         "taxon_environment" "motility"         </span></span>
<span><span class="co">## [31] "life_habit"        "diet"              "early_stage"       "late_stage"        "max_ma"           </span></span>
<span><span class="co">## [36] "interval_mid_ma"   "min_ma"            "id"                "n_bins"            "bin_assignment"   </span></span>
<span><span class="co">## [41] "bin_midpoint"</span></span></code></pre>
<p>As you can see, four new columns (variables) have been added to our
dataset. Two of these are especially important. First is the
<code>bin_assignment</code>, which shows which number bin the occurrence
has been added to. Second is <code>n_bins</code> - this shows how many
bins the occurrence could potentially have been placed within. Let’s
examine this further.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a table of potential number of bins</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">mid_tetrapods</span><span class="op">$</span><span class="va">n_bins</span><span class="op">)</span> <span class="co"># raw counts</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##    1    2    3    4    5    6    7    8    9 </span></span>
<span><span class="co">##  843 1754  425  268   33   34    3    2   16</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">mid_tetrapods</span><span class="op">$</span><span class="va">n_bins</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mid_tetrapods</span><span class="op">)</span> <span class="co"># proportions</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##            1            2            3            4            5            6            7            8 </span></span>
<span><span class="co">## 0.2495559503 0.5192421551 0.1258140912 0.0793368857 0.0097690941 0.0100651273 0.0008880995 0.0005920663 </span></span>
<span><span class="co">##            9 </span></span>
<span><span class="co">## 0.0047365305</span></span></code></pre>
<p>As you can see, only ~25% of the dataset can be assigned to just one
bin - the other occurrences can’t be confidently assigned to an
individual time interval. This is where the other methods for the
<code>bin_time</code> function come in handy. They provide the user with
different options when assigning occurrences to bins. Instead of the
‘mid’ method, let’s try the ‘majority’ method instead, which places the
occurrences in the bin which covers the majority of their potential time
range.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bin occurrences into chosen time bins</span></span>
<span><span class="va">maj_tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bin_time.html">bin_time</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">cp_tetrapods</span>,</span>
<span>                          bins <span class="op">=</span> <span class="va">bins</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">'majority'</span><span class="op">)</span></span></code></pre></div>
<p>We’d recommend playing around with these different options and seeing
how they impact your results!</p>
<p>Next, we’ll also bin our occurrences spatially. We need a couple of
functions to do this. Firstly, we need to add palaeocoordinates to our
dataset. We can use the <code>palaeorotate</code> function to do
this.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Palaeorotate occurrences</span></span>
<span><span class="va">maj_tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/palaeorotate.html">palaeorotate</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">maj_tetrapods</span>, age <span class="op">=</span> <span class="st">"bin_midpoint"</span>,</span>
<span>                              method <span class="op">=</span> <span class="st">"point"</span>, model <span class="op">=</span> <span class="st">"PALEOMAP"</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s check that it’s worked…</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check palaeocoordinates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">maj_tetrapods</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p_lng"</span>, <span class="st">"p_lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      p_lng    p_lat</span></span>
<span><span class="co">## 1 -39.1618   2.9214</span></span>
<span><span class="co">## 2 -34.0923 -59.1326</span></span>
<span><span class="co">## 4 -29.7188  -0.1250</span></span>
<span><span class="co">## 5 -27.9228   3.6845</span></span>
<span><span class="co">## 6 -29.0469  -0.2730</span></span>
<span><span class="co">## 7 -16.5579  -6.0513</span></span></code></pre>
<p>Looks good to me! Now that we have palaeocoordinates for our
occurrences, we can put them into spatial bins. We can do this using the
<code>bin_space</code> function, which assigns each occurrence to one of
many discrete equal-area hexagonal grid cells (based on <a href="https://h3geo.org/" class="external-link">Uber’s H3 system</a>).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a table of potential number of bins</span></span>
<span><span class="va">maj_tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bin_space.html">bin_space</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">maj_tetrapods</span>,</span>
<span>                           lng <span class="op">=</span> <span class="st">'p_lng'</span>,</span>
<span>                           lat <span class="op">=</span> <span class="st">'p_lat'</span>,</span>
<span>                           spacing <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Average spacing between adjacent cells in the primary grid was set to 103.6 km. </span></span>
<span><span class="co">## H3 resolution: 3</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show the first 6 rows of the new columns added using `bin_space`.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">maj_tetrapods</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cell_ID"</span>, <span class="st">"cell_centroid_lng"</span>, <span class="st">"cell_centroid_lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           cell_ID cell_centroid_lng cell_centroid_lat</span></span>
<span><span class="co">## 1 8380d4fffffffff         -38.83199        3.04111345</span></span>
<span><span class="co">## 2 83dd68fffffffff         -34.66666      -59.09848198</span></span>
<span><span class="co">## 4 837c65fffffffff         -29.87643       -0.04859754</span></span>
<span><span class="co">## 5 837c40fffffffff         -27.94272        3.31086571</span></span>
<span><span class="co">## 6 837c64fffffffff         -28.90531       -0.63974717</span></span>
<span><span class="co">## 7 837da3fffffffff         -16.16673       -6.15422544</span></span></code></pre>
<p><code>bin_space</code> adds some new columns, including one with the
unique grid cell ID, as well as latitudinal and longitudinal coordinates
for the centroid of that cell.</p>
<p>Now that we have both temporal and spatial bins, we can use these
data to see how the spatial coverage of tetrapod fossils in our dataset
varies through time.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract unique interval midpoints</span></span>
<span><span class="va">midpoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">maj_tetrapods</span><span class="op">$</span><span class="va">bin_midpoint</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the number of unique cells in each time bin</span></span>
<span><span class="va">unique_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">maj_tetrapods</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bin_midpoint"</span>, <span class="st">"cell_ID"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">spat.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_apply.html">group_apply</a></span><span class="op">(</span><span class="va">unique_cells</span>, group <span class="op">=</span> <span class="st">"bin_midpoint"</span>, fun <span class="op">=</span> <span class="va">nrow</span><span class="op">)</span></span></code></pre></div>
<p>Let’s save that for now and move on to some of our analyses!</p>
</div>
<div class="section level2">
<h2 id="unique-taxa-and-alpha-diversity">Unique taxa and alpha diversity<a class="anchor" aria-label="anchor" href="#unique-taxa-and-alpha-diversity"></a>
</h2>
<p>In many cases palaeobiologists count unique taxa by retaining only
unique occurrences identified to a given taxonomic resolution
(e.g. genera or species); however, this can result in some useful
information being discarded. The <code>tax_unique</code> function
retains occurrences identified to a coarser taxonomic resolution which
are not already represented within the dataset. Take, for example, the
following occurrences:</p>
<ul>
<li><em>Albertosaurus sarcophagus</em></li>
<li>
<em>Ankylosaurus</em> sp.</li>
<li>
<em>Ceratopsidae</em> indet.</li>
<li>
<em>Ornithominus</em> sp.</li>
<li><em>Tyrannosaurus rex</em></li>
</ul>
<p>A filter for species-level identifications would reduce the species
richness to just two (<em>A. sarcophagus</em> and <em>T. rex</em>).
However, none of these clades are nested within one another, so each of
the indeterminately identified occurrences represents at least one
species not already represented in the dataset. <code>tax_unique</code>
is designed to deal with such taxonomic data and would retain all seven
‘species’ in this example. For further details see
<code><a href="../reference/tax_unique.html">?tax_unique</a></code>.</p>
<p>This function can be especially useful for when looking at alpha
diversity (local richness). Let’s apply it to our dataset by filtering
it to genus-level.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to genus-level:</span></span>
<span><span class="va">tet_genera</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tax_unique.html">tax_unique</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">maj_tetrapods</span>, genus <span class="op">=</span> <span class="st">"genus"</span>, family <span class="op">=</span> <span class="st">"family"</span>,</span>
<span>                         order <span class="op">=</span> <span class="st">"order"</span>, class <span class="op">=</span> <span class="st">"class"</span>, resolution <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span></span></code></pre></div>
<p>We can compare this to the genera from the original dataset to see
how many genera were added by using <code><a href="../reference/tax_unique.html">tax_unique()</a></code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many unique genera before:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">maj_tetrapods</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 717</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many unique genera after:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tet_genera</span><span class="op">$</span><span class="va">unique_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 719</span></span></code></pre>
<p>As you can see we’ve added two taxa that otherwise would have been
ignored! To see more specifically how the function has performed, take a
look at row 718, which records an indeterminate occurrence of the family
<em>Dicynodontidae</em>. This occurrence now has a unique name of
‘Dicynodontidae indet.’</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See just row 718</span></span>
<span><span class="va">tet_genera</span><span class="op">[</span><span class="fl">718</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##            class        order         family genus           unique_name</span></span>
<span><span class="co">## 718 Osteichthyes Dicynodontia Dicynodontidae  &lt;NA&gt; Dicynodontidae indet.</span></span></code></pre>
<p>Now, let’s use this function to extract the unique genera for each
collection (=locality) with <code>group_apply</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use group_apply along with tax_unique:</span></span>
<span><span class="va">coll_genera</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_apply.html">group_apply</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">maj_tetrapods</span>,</span>
<span>                           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"collection_no"</span><span class="op">)</span>,</span>
<span>                           fun <span class="op">=</span> <span class="va">tax_unique</span>,</span>
<span>                           genus <span class="op">=</span> <span class="st">"genus"</span>,</span>
<span>                           family <span class="op">=</span> <span class="st">"family"</span>,</span>
<span>                           order <span class="op">=</span> <span class="st">"order"</span>,</span>
<span>                           class <span class="op">=</span> <span class="st">"class"</span>,</span>
<span>                           resolution <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See structure of the new dataframe:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">coll_genera</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    2853 obs. of  6 variables:</span></span>
<span><span class="co">##  $ class        : chr  "Osteichthyes" "Osteichthyes" "Osteichthyes" "Reptilia" ...</span></span>
<span><span class="co">##  $ order        : chr  NA "Temnospondyli" "Cotylosauria" NA ...</span></span>
<span><span class="co">##  $ family       : chr  NA "Dissorophidae" NA "Bolosauridae" ...</span></span>
<span><span class="co">##  $ genus        : chr  NA "Parioxys" "Archeria" "Bolosaurus" ...</span></span>
<span><span class="co">##  $ unique_name  : chr  "Osteichthyes indet." "Parioxys sp." "Archeria sp." "Bolosaurus sp." ...</span></span>
<span><span class="co">##  $ collection_no: chr  "11149" "11152" "11165" "11165" ...</span></span></code></pre>
<p>Next, let’s count the number of unique genera per collection:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the names of unique genera per collection</span></span>
<span><span class="va">unique_genera</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">coll_genera</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unique_name"</span>, <span class="st">"collection_no"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the number of unique genera per collection</span></span>
<span><span class="va">coll_taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_apply.html">group_apply</a></span><span class="op">(</span><span class="va">unique_genera</span>, group <span class="op">=</span> <span class="st">"collection_no"</span>, fun <span class="op">=</span> <span class="va">nrow</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename column names:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">coll_taxa</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_taxa"</span>, <span class="st">"collection_no"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take a quick look at the new dataframe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coll_taxa</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   n_taxa collection_no</span></span>
<span><span class="co">## 1      1        104796</span></span>
<span><span class="co">## 2      1        106270</span></span>
<span><span class="co">## 3      3        106558</span></span>
<span><span class="co">## 4      8        108766</span></span>
<span><span class="co">## 5      3        109702</span></span>
<span><span class="co">## 6      1         11149</span></span></code></pre>
<p>To plot an alpha diversity (local richness) plot, we will need to add
interval age data to these collections:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Take the columns pertaining to collections and their ages in millions of years:</span></span>
<span><span class="va">coll_info</span> <span class="op">&lt;-</span> <span class="va">maj_tetrapods</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"collection_no"</span>, <span class="st">"max_ma"</span>, <span class="st">"interval_mid_ma"</span>, <span class="st">"min_ma"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove duplicated collections based on the collection number (column 1)</span></span>
<span><span class="va">coll_info</span> <span class="op">&lt;-</span> <span class="va">coll_info</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">coll_info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Combine this dataframe with the dataframe from above</span></span>
<span><span class="va">alpha_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">coll_info</span>, <span class="va">coll_taxa</span>, by <span class="op">=</span> <span class="st">"collection_no"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take a look:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">alpha_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   collection_no max_ma interval_mid_ma min_ma n_taxa</span></span>
<span><span class="co">## 1         11149 290.10          284.70 283.50      1</span></span>
<span><span class="co">## 2         11152 293.52          283.90 272.95      1</span></span>
<span><span class="co">## 3         11165 298.90          294.50 290.10      9</span></span>
<span><span class="co">## 4         11323 303.70          301.15 293.52      1</span></span>
<span><span class="co">## 5         12943 307.00          302.40 298.90      1</span></span>
<span><span class="co">## 6         12976 283.50          275.80 272.95      7</span></span></code></pre>
<p>Done. Now to plot alpha diversity through time! Let’s start with a
simple scatterplot:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a plot for alpha diversity in the Carboniferous and Permian</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha_data</span><span class="op">$</span><span class="va">interval_mid_ma</span>, <span class="va">alpha_data</span><span class="op">$</span><span class="va">n_taxa</span>, <span class="co"># add the points</span></span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">alpha_data</span><span class="op">$</span><span class="va">interval_mid_ma</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, <span class="co"># reverse the x-axis</span></span>
<span>     xlab<span class="op">=</span><span class="st">"Time (Ma)"</span>, ylab<span class="op">=</span><span class="st">"No. taxa"</span>, <span class="co"># axes labels</span></span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"#0e826f"</span><span class="op">)</span> <span class="co"># point style and colour</span></span></code></pre></div>
<div class="figure">
<img src="alpha-div-plot-1-1.png" alt="plot of chunk alpha-div-plot-1" width="100%"><p class="caption">
plot of chunk alpha-div-plot-1
</p>
</div>
<p>That looks good, but it’s a bit difficult to figure out what stages
contain which data points. <code><a href="../reference/axis_geo.html">axis_geo()</a></code> adds a geological
timescale between the plot and the axis.</p>
<p>Taking our plot from above, let’s use this function to add a
timescale to the x-axis:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set margins</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span><span class="op">)</span><span class="op">)</span> <span class="co"># expand at bottom if adding more interval categories</span></span>
<span></span>
<span><span class="co"># Make the final alpha diversity plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha_data</span><span class="op">$</span><span class="va">interval_mid_ma</span>, <span class="va">alpha_data</span><span class="op">$</span><span class="va">n_taxa</span>, <span class="co"># add the points</span></span>
<span>     axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">alpha_data</span><span class="op">$</span><span class="va">interval_mid_ma</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, <span class="co"># reverse the x-axis</span></span>
<span>     xlab <span class="op">=</span> <span class="st">" "</span>, ylab <span class="op">=</span> <span class="st">"No. taxa"</span>, <span class="co"># axes labels</span></span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"#0e826f"</span><span class="op">)</span> <span class="co"># point style and colour</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="co"># add a normal axis to the elft side</span></span>
<span><span class="fu"><a href="../reference/axis_geo.html">axis_geo</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">1</span>, intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"epochs"</span>, <span class="st">"periods"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>xlab <span class="op">=</span> <span class="st">"Time (Ma)"</span>, line <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="alpha-div-plot-2-1.png" alt="plot of chunk alpha-div-plot-2" width="100%"><p class="caption">
plot of chunk alpha-div-plot-2
</p>
</div>
<p>Amazing! Now we can clearly see that alpha diversity appears to be a
lot higher in the Permian than the Carboniferous. But how has the
spatial distribution of tetrapods changed across this boundary? Let’s
use some of the other <code>palaeoverse</code> functions to find
out!</p>
</div>
<div class="section level2">
<h2 id="exploring-range-sizespatial-issues-through-time">Exploring range size/spatial issues through time<a class="anchor" aria-label="anchor" href="#exploring-range-sizespatial-issues-through-time"></a>
</h2>
<p>Another factor that we can examine is how range size of taxa changed
across the C/P boundary. We can examine this spatial distribution
through time using the <code>tax_range_space</code> function, which
provides several different methods for estimating the distribution of
taxonomic occurrences. For now we’ll use the method <code>con</code>
which calculates the geographic range of taxa using a convex hull, but
the rest of the methods are described in detail in the function
documentation which can be accessed via
<code><a href="../reference/tax_range_space.html">?tax_range_space</a></code>.</p>
<p>We can use this in combination with <code>group_apply</code> to
calculate the average for each time interval for our dataset:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, remove any occurrences without a genus</span></span>
<span><span class="va">space_tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">maj_tetrapods</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find temporal range of all genera</span></span>
<span><span class="va">space_tetrapods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_apply.html">group_apply</a></span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">space_tetrapods</span>,</span>
<span>                               group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bin_midpoint"</span><span class="op">)</span>,</span>
<span>                               fun <span class="op">=</span> <span class="va">tax_range_space</span>,</span>
<span>                               name <span class="op">=</span> <span class="st">"genus"</span>,</span>
<span>                               lng <span class="op">=</span> <span class="st">"p_lng"</span>,</span>
<span>                               lat <span class="op">=</span> <span class="st">"p_lat"</span>,</span>
<span>                               method <span class="op">=</span> <span class="st">"con"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Have a look at the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">space_tetrapods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               taxon taxon_id      area bin_midpoint</span></span>
<span><span class="co">## 1         Abdalodon        1      0.00       257.05</span></span>
<span><span class="co">## 2         Acrodenta        2      0.00       257.05</span></span>
<span><span class="co">## 3       Adelosaurus        3      0.00       257.05</span></span>
<span><span class="co">## 4     Aelurognathus        4 292392.77       257.05</span></span>
<span><span class="co">## 9      Aelurosaurus        5  14698.41       257.05</span></span>
<span><span class="co">## 14 Aenigmastropheus        6      0.00       257.05</span></span></code></pre>
<p>As you can see, the combination of <code>group_apply</code> and
<code>tax_range_space</code> produces a dataset with the area of
geographic range for each taxon in kilometers squared for each time
interval. Note that an area of zero here means that there is only one
occurrence of that taxon in that time bin. From this information we can
now plot how the average range size of tetrapods changed throughout the
Carboniferous and Permian:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the average geographic range size for each time interval</span></span>
<span><span class="va">space_tetrapods_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_apply.html">group_apply</a></span><span class="op">(</span><span class="va">space_tetrapods</span>, <span class="st">"bin_midpoint"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">area</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">space_tetrapods_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_area"</span>, <span class="st">"bin_midpoint"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a plot of average range size through time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">space_tetrapods_mean</span><span class="op">$</span><span class="va">bin_midpoint</span>, <span class="va">space_tetrapods_mean</span><span class="op">$</span><span class="va">mean_area</span>, <span class="co"># add the points</span></span>
<span>     axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">space_tetrapods_mean</span><span class="op">$</span><span class="va">bin_midpoint</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, <span class="co"># reverse the x-axis</span></span>
<span>     xlab <span class="op">=</span> <span class="st">" "</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Average range size of tetrapod genera (km"</span><span class="op">^</span><span class="fl">2</span><span class="op">~</span><span class="st">")"</span><span class="op">)</span>, <span class="co"># axes labels</span></span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"#0e826f"</span><span class="op">)</span> <span class="co"># point style and colour</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="co"># add a normal axis to the left side</span></span>
<span><span class="fu"><a href="../reference/axis_geo.html">axis_geo</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">1</span>, intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"epochs"</span>, <span class="st">"periods"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>xlab <span class="op">=</span> <span class="st">"Time (Ma)"</span>, line <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="alpha-div-plot-3-1.png" alt="plot of chunk alpha-div-plot-3" width="100%"><p class="caption">
plot of chunk alpha-div-plot-3
</p>
</div>
<p>From this plot it seems like the average geographic range size of
tetrapods increased during the Permian. However, we first need to be
sure we’re not picking up on another pattern. Remember how we calculated
the number of unique geographic cells in each time interval earlier?
This provides a measure of the spatial spread of the fossil record. It
might be that we’re not picking up on an increased range size but just a
larger geographic spread of fossil bearing rocks within the Permian. To
see if this is the case, we can run a simple correlation test between
the average geographic range size of tetrapods and the number of unique
grid cells in each time interval:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run a correlation test between mean range size and the spatial spread of cells</span></span>
<span><span class="co"># through time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">space_tetrapods_mean</span><span class="op">$</span><span class="va">mean_area</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">spat.cov</span><span class="op">$</span><span class="va">nrow</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Spearman's rank correlation rho</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  log10(space_tetrapods_mean$mean_area) and log10(spat.cov$nrow)</span></span>
<span><span class="co">## S = 226.12, p-value = 0.01898</span></span>
<span><span class="co">## alternative hypothesis: true rho is not equal to 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##       rho </span></span>
<span><span class="co">## 0.5962179</span></span></code></pre>
<p>The high rho value and a p-value less than our cut off for
significance (0.05) indicate a strong and statistically significant
correlation between average geographic range size and the spatial spread
of data. Seems like this work is far from over…</p>
<p>…but we’ll leave the rest to you!</p>
<p>Hopefully this vignette has shown you the potential uses for
<code>palaeoverse</code> functions and helped provide a workflow for
your own analyses. If you have any questions about the package or its
functionality, please feel free to join our <a href="https://groups.google.com/g/palaeoverse" class="external-link">Palaeoverse Google
group</a> and leave a question; we’ll aim to answer it as soon as
possible!</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Dunne, E.M., Close, R.A., Button, D.J., Brocklehurst, N., Cashmore,
D.D., Lloyd, G.T. and Butler, R.J., 2018. Diversity change during the
rise of tetrapods and the impact of the ‘Carboniferous rainforest
collapse’. Proceedings of the Royal Society B: Biological Sciences,
285(1872), 20172730.</p>
</div>
</div>
<style type="text/css">
p.caption {
  display: none;
}
</style></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.lewisajones.com" class="external-link">Lewis A. Jones</a>, <a href="https://williamgearty.com" class="external-link">William Gearty</a>, <a href="https://bsse.ethz.ch/cevo/the-group/people/person-detail.html?persid=295484" class="external-link">Bethany J. Allen</a>, <a href="https://keichenseer.netlify.app" class="external-link">Kilian Eichenseer</a>, <a href="https://www.ucl.ac.uk/earth-sciences/people/research-staff/dr-chris-dean" class="external-link">Christopher D. Dean</a>, <a href="https://www.researchgate.net/profile/Joseph-Flannery-Sutherland" class="external-link">Joseph T. Flannery-Sutherland</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
